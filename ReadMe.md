## Предсказание вероятности совершения покупки в течение 90 дней

**Описание и цель проекта:**  

Интернет-магазин собирает историю покупателей, проводит рассылки предложений и планирует будущие продажи. Для оптимизации процессов надо выделить пользователей, которые готовы совершить покупку в ближайшее время.

**Описание данных:**

Датасет состоит из пяти файлов: 

*apparel-purchases.csv* - данные о покупках клиентов по дням и по товарам. В каждой записи покупка определенного товара, его цена, количество штук  
*apparel-messages.csv* - рассылки, которые были отправлены клиентам из таблицы покупок  
*full_campaign_daily_event.csv* - агрегация общей базы рассылок по дням и типам событий  
*full_campaign_daily_event_channel.csv* - агрегация по дням с учетом событий и каналов рассылки  
*apparel-target_binary* - целевой признак. Для каждого идентификатора клиента необходимо предсказать категориальное значение   соответствующее прогнозу [0, 1].

**Описание полей данных:**

apparel-purchases

*client_id* - идентификатор клиента  
*quantity* - количество единиц товара  
*price* - цена товара  
*category_ids* - идентификаторы категорий  
*date* - дата покупки  
*message_id* - идентификатор сообщения из рассылки  

apparel-messages

*bulk_campaign_id* - идентификатор рассылки  
*client_id* - идентификатор клиента  
*message_id* - идентификатор сообщения  
*event* - действие с сообщением (отправлено, открыто, покупка...)  
*channel* - канал рассылки  
*date* - дата действия  
*created_at* - дата-время полностью  

full_campaign_daily_event

*date* - дата  
*bulk_campaign_id* - идентификатор рассылки  
*count_event* - общее количество каждого события event  
*nunique_event* - количество уникальных client_id в каждом событии  

full_campaign_daily_event_channel

*date* - дата  
*bulk_campaign_id* - идентификатор рассылки  
*count_event_channel* - общее количество каждого события по каналам  
*nunique_event_channel* - количество уникальных client_id по событиям и каналам  

apparel-target_binary

*client_id* - идентификатор клиента  
*target* - клиент совершил покупку в целевом периоде  


Целью настоящего исследования является разработка модели, определяющей пользователей, которые готовы совершить покупку в ближайшее время

Необходимые для исследования данные загружены, проверены на корректность отображения, также выведены основные статистические параметры датасетов.

В рамках предварительной обработки:

- загружены необходимые для исследования датасеты;
- датасеты проверены на корректность вывода;
- датасет проверен на наличие пропусков в данных (пропуски не выявлены);
- данные проверены на наличие явных дубликатов, выяыленные дубликаты удалены из датасета;
- значения, отображающие даты событий, переведены из строкового формата в формат datetime.

В рамках исследовательского анализа:

- выявлено сильное преобладание значения 1 в столбце 'quantity' датасета df_purchases;
- выявлено различие между минимальной и максимальной датой датасетов df_purchases и df_messages, также выявлено что топ-20 самых распространенных значений дат датасета df_purchases представлены годами 2022 и 2023, в то время когда топ-20 датасета df_messages представлены годами 2023 и 2024;
- выявлен дисбаланс в значениях целевого признака: количество клиентов имеющих метку 0 (клиент не сделает покупку) сильно превалирует над количеством клиентов с меткой 1 (клиент сделает покупку).
Разработан следующие синтетические признаки:

- 'quantity_90' - количество товаров, приобретенных в последние 90 дней;
- 'month' - номер месяца покупки;
- 'revenue' - выручка полусченная от клиента;
- 'cat1', 'cat2', 'cat3', 'cat4', 'cat5' - уровни категорий по стоkбцу 'category_ids';
- 'purchase_row' - количество дней, в которые были совершены покупки (если таких дней было более 1)
- 'date_min' - минимальная дата покупки;
- 'date_max' - максимальная дата покупки;
- 'delta_date' - разница между самой поздней покупкой в датасете и самой поздней покупкой у конкретного клиента;
- 'event_X' - где X это все уникальные значения столбца event;
- 'channel_X' - где X это все уникальные значения столбца channel.
Выполнена проверка на мультиколлинеарность путем составления матрицы корреляции. Удалены сильно коррелирующие между собой входящие признаки. Также некоторые признаки удалены или оставлены в датасете постфактум, по результату экспериментов на моделях с разным набором признаков.

По результату обучения на тренировочной выборке, определены следующие парааметры модели/пайплайна, формирующие наилучшие результаты на кросс-валидационной выборке:

- масштабирование: RobustScaler()

- кодирование: не требуется

- модель: LogisticRegression(C=2, class_weight='balanced', penalty='l1', random_state=42, solver='liblinear'))])

- метрика ROC- AUC на кросс-валидационной выборке: 0.733

- метрики на тестовой выборке:

  Accuracy = 0.74
  ROC-AUC = 0.745
  F1-score = 0.086
  recall = 0.638
  precision = 0.046

Также матрица ошибок показала, что среди 240 потенциальных покупателей, модель верно определила 153 клиента, что составило 64%, однако также модель ошибочно определила 3159 клиентов, которые не будут делать покупки, как потенциальных покупателей. Отделу маркетинга стоит учесть данный факт при формировании рекламных рассылок клиентам.


По результатам анализа SHAP графиков, можно прийти к следующим выводам:
Возьмем за границу, разделяющую важные признаки от неважных - среднее значение Шепли, равные 0.05.
Тогда получим, что:
- менее на прогноз целевого признака влияют следующие входные параметры: 'revenue', 'date_max', 'event_send', 'event_unsubscribe';
- более всего на прогноз целевого признака влияют следующие входные параметры: 'channel_email', 'event_click', 'event_open',  'purchase_row', 'delta_date'.

На основании описанного выше, для повышения вероятности совершения покупки клиентом, стоит направлять рекламные рассылки людям, которые в совершали покупку в один из ближайших дней и при этом также они совершали одну и более покупок в другие дни до этого.
 
Тогда получим, что:

менее на прогноз целевого признака влияют следующие входные параметры: 'revenue', 'date_max', 'event_send', 'event_unsubscribe';
более всего на прогноз целевого признака влияют следующие входные параметры: 'channel_email', 'event_click', 'event_open', 'purchase_row', 'delta_date'.

На основании описанного выше, для повышения вероятности совершения покупки клиентом, стоит направлять рекламные рассылки людям, которые в совершали покупку в один из ближайших дней и при этом также они совершали одну и более покупок в другие дни до этого.
